---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
editor_options: 
  markdown: 
    wrap: 72
---

Test hypothesis that COVID behavior scores (continuously or dummy coded) are significantly correlated with COVID protection behaviors among the agents. 

## Load libraries, set working directory, and dataset used in descriptive analysis

```{r, echo=FALSE, message=FALSE}
rm(list=ls())
library(haven)
library(dplyr)
library(data.table)
library(lme4)
library(geeM)
```

Set the working directory:

```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Volumes/caas/CADRE CLC Data Project5/Clean Data/AK-SU-NETWORKS-ROUT")
```

Read the datasets:

```{r, include=FALSE}
network_env <- readRDS("network_objects.rds")
sns_dt_long_wide_no_minors <- network_env$sns_dt_long_wide_no_minors

eda_env <- readRDS("eda_objects.rds")
tab2_dt <- as.data.table(eda_env$tab2_dt)
cdc_scores <- eda_env$cdc_scores

tab2_dt$MTURKID <- as.factor(tab2_dt$MTURK1)
```

Query the dataset:

```{r}
#View(sns_dt_long_wide_no_minors)
colnames(sns_dt_long_wide_no_minors)
```

Demographics on the egos are present in the `tab2_dt` object in the `eda_env` environment.


Merge ego demographics into long form network dataset:

```{r}
sns_dt_long_merged_ego_characteristics <- merge(sns_dt_long_wide_no_minors, tab2_dt, by="MTURKID")
class(sns_dt_long_merged_ego_characteristics)
#sns_dt_long_merged_ego_characteristics$MTURKID <- as.factor(sns_dt_long_merged_ego_characteristics$MTURKID)

sns_dt_long_merged_ego_characteristics[,age := as.numeric(age)]
```




```{r}
#model <- glmer(outcome ~ predictor1 + predictor2 + (1 | ego_id), data = data, family = binomial)

model_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN27 + SN28 + SN33 + SN34 + SN37 + SN38 + (1|MTURKID), family="binomial")
summary(model_disc_glmer)

model_disc_glmer <- glmer(cdc_avg_out_adequate ~ SN27 + SN28 + SN33 + SN34 + SN37 + SN38 + (1|MTURKID), data = sns_dt_long_merged_ego_characteristics, family="binomial")


m1_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN27 + (1|MTURKID), family="binomial")
summary(m1_disc_glmer)

m2_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN28 + (1|MTURKID), family="binomial")
summary(m2_disc_glmer)

m3_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN33 + (1|MTURKID), family="binomial")
summary(m3_disc_glmer)

m4_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN34 + (1|MTURKID), family="binomial")
summary(m4_disc_glmer)

m5_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN37 + (1|MTURKID), family="binomial")
summary(m5_disc_glmer)

m6_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN38 + (1|MTURKID), family="binomial")
summary(m6_disc_glmer)

m7_disc_glmer <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN39 + (1|MTURKID), family="binomial")
summary(m7_disc_glmer)
```
Discrete Outcome
```{r}
model_disc <- glmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN27 + SN28 + SN33 + SN34 + SN37 + SN38 + (1|MTURKID), family="binomial")
summary(model_disc)
```

Continuous Outcome

```{r}
# Set the control options
ctrl <- lmerControl(optCtrl = list(maxfun = 1e7))

# model_cont <- lmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out.x ~ 
#                  SN27 + SN28 + SN33 + SN34 + SN37 + SN38 + (1|MTURKID),
#                  control = ctrl)

model_cont_28 <- lmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out ~
                 SN28 + (1|MTURKID),
                 control = ctrl)
summary(model_cont_28)

model_cont_33 <- lmer(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out ~
                 SN28 + (1|MTURKID),
                 control = ctrl)
summary(model_cont_33)
```

```{r}
model_disc_gee <- geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN27 + SN28 + SN29 + SN33 + SN34 + SN37 + SN38, id = MTURKID, family="binomial")
summary(model_disc_gee)

m1_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN27, id = MTURKID, family="binomial")
summary(m1_gee_disc)

m2_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN28, id = MTURKID, family="binomial")
summary(m2_gee_disc)

m2a_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN29, id = MTURKID, family="binomial")
summary(m2a_gee_disc)

m3_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN33, id = MTURKID, family="binomial")
summary(m3_gee_disc)

m4_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN34, id = MTURKID, family="binomial")
summary(m4_gee_disc)

m5_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN37, id = MTURKID, family="binomial")
summary(m5_gee_disc)

m6_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN38, id = MTURKID, family="binomial")
summary(m6_gee_disc)

m7_gee_disc <- 
  geem(data=sns_dt_long_merged_ego_characteristics, cdc_avg_out_adequate ~ 
                 SN39, id = MTURKID, family="binomial")
summary(m7_gee_disc)
```

```{r}
model_cont_gee <- geem(cdc_avg_out ~ SN27 + SN28 + SN29 + SN33 + SN34 + SN37 + SN38, 
                  id=MTURKID, data=sns_dt_long_merged_ego_characteristics, 
                  family=gaussian, corstr="exchangeable")

summary(model_cont_gee)
```

