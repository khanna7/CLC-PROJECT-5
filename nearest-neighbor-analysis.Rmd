---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
editor_options: 
  markdown: 
    wrap: 72
---

We present the nearest neighbor analysis in this document. 

Set working directory:

```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Volumes/caas/CADRE CLC Data Project5/Clean Data/AK-SU-NETWORKS-ROUT")
```

```{r}
library(igraph)
```

Read social network data with minors removed, including MTURK IDs for participants 
and faux-IDs for alters:

```{r}
rm(list=ls())
sns_dt_read <- readRDS("sns_dt_long_wide_no_minors.RDS")
dim(sns_dt_read)
class(sns_dt_read)
```

We follow ideas from [Kolaczyk](https://paperpile.com/app/p/c70e3441-d39c-0d0c-9f1f-f476139d2e86), 
Chapter 8, to conduct this analysis.

Initialize data as an `igraph` object:

```{r}
ig <- graph_from_data_frame(d = sns_dt_read, directed = TRUE)
ig
```

Number of edges and vertices respectively:

```{r}
gorder(ig) #num nodes
gsize(ig) #num edges
```

We know that there are 

```{r}
length(unique(sns_dt_read$MTURKID))
``` 
participants who reported data on 

```{r}
length(unique(sns_dt_read$alterID))
```
adult network members.

We can verify that the sum of the above two quantities is the total number of 
nodes in the network:

```{r}
length(unique(sns_dt_read$MTURKID)) + length(unique(sns_dt_read$alterID)) ==
  gorder(ig)
```
Add vertex attributes to `ig`. To do this, we first want to pull out the 
alter IDs and the attributes in the `sns_dt_read` dataset above, and convert it 
to long format. 

```{r}
net_dt_wide <- sns_dt_read[, !c("MTURKID", "comp_code_Text_Set")]
dim(net_dt_wide)
```

The next steps is to extract the relevant individual attributes of the 173 participants who
provided data on their social networks:

```{r}
consenting_network_participant_dt <- readRDS("sns_consenting_dt.RDS")
dim(consenting_network_participant_dt)
```

Dataset on other individual-level variables for all participants who completed
the baseline survey:

```{r}
all_participant_dt <- readRDS("participant_dt_wide.RDS")
```

